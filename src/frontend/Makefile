OCAML=ocamlfind ocamlc -linkpkg -thread -package core
BACKEND=../backend
OBJS=scanner.cmo parser.cmo
EXT_OBJS=$(BACKEND)/semantics.cmo
EXT_OBJS=
INCLUDE=-I ../include -I $(BACKEND)
TARGETS=$(COMPILER)
OCAML_FLAGS=$(INCLUDE) $(EXT_OBJS)
COMPILER=shuxc

all: $(OBJS) $(TARGETS)

%: %.ml $(OBJS)
	$(OCAML) $(OCAML_FLAGS) -o $@ $(LIBS) $(OBJS) $<

scanner.ml: scanner.mll exceptions.cmo
	ocamllex scanner.mll

parser.ml parser.mli: parser.mly
	ocamlyacc parser.mly

automata: parser.mly
	ocamlyacc -v parser.mly

%.cmo: %.ml
	$(OCAML) $(OCAML_FLAGS) -c $<
%.cmi: %.mli
	$(OCAML) $(OCAML_FLAGS) -c $<
.PHONY: clean test

clean:
	rm -rf *.cmo *.cmi parser.mli parser.ml parser.output scanner.ml

#generated by ocamldep *.ml *.mli
projparser.cmo: scanner.cmo parser.cmi ast.cmi
projparser.cmx: scanner.cmx parser.cmx ast.cmi
parser.cmo: ast.cmi parser.cmi
parser.cmx: ast.cmi parser.cmi
scanner.cmo: parser.cmi
scanner.cmx: parser.cmx
ast.cmi:
parser.cmi: ast.cmi
