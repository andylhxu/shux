CAMLC=ocamlc
OCAML=ocamlfind $(CAMLC) -linkpkg -thread -package core -package llvm -package llvm.analysis
OBJS=exceptions.cmo scanner.cmo parser.cmo semant.cmo codegen.cmo
INCLUDE=-I ../include -g
TARGETS=$(COMPILER)
OCAML_FLAGS=$(INCLUDE) $(OBJS)
COMPILER=shuxc

all: $(OBJS) $(TARGETS)

%: %.ml $(OBJS) $(EXT_OBJS)
	$(OCAML) $(OCAML_FLAGS) -o $@ $(LIBS) $<

shuxc:

scanner.ml: scanner.mll exceptions.cmo
	ocamllex scanner.mll

parser.ml parser.mli: parser.mly
	ocamlyacc parser.mly

automata: parser.mly
	ocamlyacc -v parser.mly

%.cmo: %.ml
	$(OCAML) $(OCAML_FLAGS) -c $<
%.cmi: %.mli
	$(OCAML) $(OCAML_FLAGS) -c $<
.PHONY: clean test

clean:
	rm -rf *.cmo *.cmi parser.mli parser.ml parser.output scanner.ml shuxc

#generated by ocamldep *.ml *.mli
projparser.cmo: scanner.cmo parser.cmi ast.cmi
projparser.cmx: scanner.cmx parser.cmx ast.cmi
parser.cmo: ast.cmi parser.cmi
parser.cmx: ast.cmi parser.cmi
scanner.cmo: parser.cmi
scanner.cmx: parser.cmx
ast.cmi:
parser.cmi: ast.cmi
exceptions.cmo:
exceptions.cmx:
codegen.cmx:
semant.cmo:
semant.cmx:
shuxc.cmo:
shuxc.cmx:

